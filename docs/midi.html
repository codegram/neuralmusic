---

title: Title
keywords: fastai
sidebar: home_sidebar

summary: "summary"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/01_midi.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> nb_black
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="a89a6022-ea36-4299-8766-89bf1ae9ec3e"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#a89a6022-ea36-4299-8766-89bf1ae9ec3e');

            setTimeout(function() {
                var nbb_cell_id = 1;
                var nbb_unformatted_code = "%load_ext nb_black";
                var nbb_formatted_code = "%load_ext nb_black";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="93496b27-274d-4c11-b504-70dddc930853"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#93496b27-274d-4c11-b504-70dddc930853');

            setTimeout(function() {
                var nbb_cell_id = 3;
                var nbb_unformatted_code = "# export\nfrom typing import Optional, Tuple\n\nfrom music21 import converter, instrument, note, chord\nfrom music21.midi import MidiException\nimport pandas as pd";
                var nbb_formatted_code = "# export\nfrom typing import Optional, Tuple\n\nfrom music21 import converter, instrument, note, chord\nfrom music21.midi import MidiException\nimport pandas as pd";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># test</span>
<span class="kn">from</span> <span class="nn">test</span> <span class="kn">import</span> <span class="n">test_eq</span>
<span class="kn">from</span> <span class="nn">music21</span> <span class="kn">import</span> <span class="n">volume</span><span class="p">,</span> <span class="n">duration</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="a848f6bc-06c7-49ee-93dc-2b30a46b77b8"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#a848f6bc-06c7-49ee-93dc-2b30a46b77b8');

            setTimeout(function() {
                var nbb_cell_id = 4;
                var nbb_unformatted_code = "# test\nfrom test import test_eq\nfrom music21 import volume, duration";
                var nbb_formatted_code = "# test\nfrom test import test_eq\nfrom music21 import volume, duration";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Representing-MIDI-notes-as-triplets">Representing MIDI notes as triplets<a class="anchor-link" href="#Representing-MIDI-notes-as-triplets">&#182;</a></h1><p>Although MIDI notes have a lot of information, we want to distill them into a triplet -- namely pitch, duration and velocity:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="d944a058-9f58-4889-9f8c-a4a6062abca0"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#d944a058-9f58-4889-9f8c-a4a6062abca0');

            setTimeout(function() {
                var nbb_cell_id = 5;
                var nbb_unformatted_code = "# export\n\nPitch, Duration, Velocity = str, float, int\nTriplet = Tuple[Pitch, Duration, Velocity]";
                var nbb_formatted_code = "# export\n\nPitch, Duration, Velocity = str, float, int\nTriplet = Tuple[Pitch, Duration, Velocity]";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>First we'll create some functions to turn single notes, chords and rests into these Triplets.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="9f7c221b-3d3a-4647-a207-9c4bf93de53c"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#9f7c221b-3d3a-4647-a207-9c4bf93de53c');

            setTimeout(function() {
                var nbb_cell_id = 9;
                var nbb_unformatted_code = "# export\n\n\ndef parse_single_note(note: note.Note) -> Triplet:\n    return (str(note.pitch), float(note.duration.quarterLength), note.volume.velocity)\n\n\ndef parse_chord(chord: chord.Chord) -> Triplet:\n    return (\n        \".\".join(str(n) for n in chord.normalOrder),\n        float(chord.duration.quarterLength),\n        chord.volume.velocity,\n    )\n\ndef parse_rest(rest: note.Rest) -> Triplet:\n    return (\"R\", float(rest.duration.quarterLength), 0)";
                var nbb_formatted_code = "# export\n\n\ndef parse_single_note(note: note.Note) -> Triplet:\n    return (str(note.pitch), float(note.duration.quarterLength), note.volume.velocity)\n\n\ndef parse_chord(chord: chord.Chord) -> Triplet:\n    return (\n        \".\".join(str(n) for n in chord.normalOrder),\n        float(chord.duration.quarterLength),\n        chord.volume.velocity,\n    )\n\n\ndef parse_rest(rest: note.Rest) -> Triplet:\n    return (\"R\", float(rest.duration.quarterLength), 0)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="parse_single_note" class="doc_header"><code>parse_single_note</code><a href="https://github.com/codegram/neuralmusic/tree/master/neuralmusic/midi.py#L20" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>parse_single_note</code>(<strong><code>note</code></strong>:<code>Note</code>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="parse_chord" class="doc_header"><code>parse_chord</code><a href="https://github.com/codegram/neuralmusic/tree/master/neuralmusic/midi.py#L24" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>parse_chord</code>(<strong><code>chord</code></strong>:<code>Chord</code>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="parse_rest" class="doc_header"><code>parse_rest</code><a href="https://github.com/codegram/neuralmusic/tree/master/neuralmusic/midi.py#L32" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>parse_rest</code>(<strong><code>rest</code></strong>:<code>Rest</code>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># test</span>
<span class="n">quarter</span> <span class="o">=</span> <span class="n">duration</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="s2">&quot;quarter&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">loud</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="n">note</span><span class="o">.</span><span class="n">Note</span><span class="p">,</span> <span class="n">velocity</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">note</span><span class="o">.</span><span class="n">Note</span><span class="p">:</span>
    <span class="n">n</span><span class="o">.</span><span class="n">volume</span> <span class="o">=</span> <span class="n">volume</span><span class="o">.</span><span class="n">Volume</span><span class="p">(</span><span class="n">velocity</span><span class="o">=</span><span class="n">velocity</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">n</span>


<span class="n">test_eq</span><span class="p">((</span><span class="s2">&quot;C3&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">120</span><span class="p">),</span> <span class="n">parse_single_note</span><span class="p">(</span><span class="n">loud</span><span class="p">(</span><span class="n">note</span><span class="o">.</span><span class="n">Note</span><span class="p">(</span><span class="s2">&quot;C3&quot;</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="n">quarter</span><span class="p">))))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="36d3d061-d43b-4cb1-b672-5450c63d245f"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#36d3d061-d43b-4cb1-b672-5450c63d245f');

            setTimeout(function() {
                var nbb_cell_id = 10;
                var nbb_unformatted_code = "# test\nquarter = duration.Duration(\"quarter\")\n\n\ndef loud(n: note.Note, velocity=120) -> note.Note:\n    n.volume = volume.Volume(velocity=velocity)\n    return n\n\n\ntest_eq((\"C3\", 1.0, 120), parse_single_note(loud(note.Note(\"C3\", duration=quarter))))";
                var nbb_formatted_code = "# test\nquarter = duration.Duration(\"quarter\")\n\n\ndef loud(n: note.Note, velocity=120) -> note.Note:\n    n.volume = volume.Volume(velocity=velocity)\n    return n\n\n\ntest_eq((\"C3\", 1.0, 120), parse_single_note(loud(note.Note(\"C3\", duration=quarter))))";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="f2e15576-bfd1-472e-a45e-82707c84ca3e"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#f2e15576-bfd1-472e-a45e-82707c84ca3e');

            setTimeout(function() {
                var nbb_cell_id = 11;
                var nbb_unformatted_code = "# export\ndef parse_midi_file(file: str) -> (Optional[pd.DataFrame], int):\n    \"\"\"\n    Attempts to parse a midi file into a Dataframe. Returns a Dataframe or None, together with the number of notes processed.\n    \"\"\"\n    try:\n        midi = converter.parse(file)\n        notes_to_parse = None\n        parts = instrument.partitionByInstrument(midi)\n        notes = []\n        if parts:  # file has instrument parts\n            notes_to_parse = parts.parts[0].recurse()\n        else:  # file has notes in a flat structure\n            notes_to_parse = midi.flat.notes\n        for element in notes_to_parse:\n            if element.__class__ == note.Note:\n                notes.append(parse_single_note(element))\n            elif element.__class__ == chord.Chord:\n                notes.append(parse_chord(element))\n            elif element.__class__ == note.Rest:\n                notes.append(parse_rest(element))\n\n        df = pd.DataFrame.from_dict(\n            {\n                \"pitches\": [[[pitch for (pitch, duration, velocity) in notes]]],\n                \"durations\": [[[duration for (pitch, duration, velocity) in notes]]],\n                \"velocities\": [[[velocity for (pitch, duration, velocity) in notes]]],\n            }\n        )\n        return (df, len(notes))\n    except MidiException:\n        return (None, 0)\n    except IndexError:\n        return (None, 0)";
                var nbb_formatted_code = "# export\ndef parse_midi_file(file: str) -> (Optional[pd.DataFrame], int):\n    \"\"\"\n    Attempts to parse a midi file into a Dataframe. Returns a Dataframe or None, together with the number of notes processed.\n    \"\"\"\n    try:\n        midi = converter.parse(file)\n        notes_to_parse = None\n        parts = instrument.partitionByInstrument(midi)\n        notes = []\n        if parts:  # file has instrument parts\n            notes_to_parse = parts.parts[0].recurse()\n        else:  # file has notes in a flat structure\n            notes_to_parse = midi.flat.notes\n        for element in notes_to_parse:\n            if element.__class__ == note.Note:\n                notes.append(parse_single_note(element))\n            elif element.__class__ == chord.Chord:\n                notes.append(parse_chord(element))\n            elif element.__class__ == note.Rest:\n                notes.append(parse_rest(element))\n\n        df = pd.DataFrame.from_dict(\n            {\n                \"pitches\": [[[pitch for (pitch, duration, velocity) in notes]]],\n                \"durations\": [[[duration for (pitch, duration, velocity) in notes]]],\n                \"velocities\": [[[velocity for (pitch, duration, velocity) in notes]]],\n            }\n        )\n        return (df, len(notes))\n    except MidiException:\n        return (None, 0)\n    except IndexError:\n        return (None, 0)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="parse_midi_file" class="doc_header"><code>parse_midi_file</code><a href="https://github.com/codegram/neuralmusic/tree/master/neuralmusic/midi.py#L36" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>parse_midi_file</code>(<strong><code>file</code></strong>:<code>str</code>)</p>
</blockquote>
<p>Attempts to parse a midi file into a Dataframe. Returns a Dataframe or None, together with the number of notes processed.</p>

</div>

</div>

</div>
</div>

</div>
</div>
 

